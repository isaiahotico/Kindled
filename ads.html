<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADS Corner</title>
<link rel="stylesheet" href="style.css">
<script src="https://libtl.com/sdk.js" data-zone="10276123" data-sdk="show_10276123"></script>
<script src="guardians.js"></script>
<script src="app.js"></script>
<style>#leaderboardBody td{color:white;}</style>
</head>
<body class="charcoal">

<a class="home" href="index.html">ğŸ  Home</a>
<h2 class="rainbow">Guardian Event</h2>

<div class="profile-card">
  <h3 id="gname"></h3>
  <p id="glore"></p>
  <progress id="hp" max="50000" value="0" style="width:100%; height:30px;"></progress>
  <p id="hpText"></p>

  <button class="magic-btn blue" id="healBtn">ğŸ’– Heal your Lords!</button>
  <button class="magic-btn green" id="showLeaderboardBtn">ğŸ† Show Leaderboard</button>
</div>

<div id="leaderboardModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h3>Top Contributors</h3>
    <table border="1" style="width:100%; text-align:left;">
      <thead><tr><th>Position</th><th>User ID</th><th>HP Contributed</th></tr></thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </div>
</div>

<script>
// Heal guardian with ads
document.getElementById("healBtn").onclick = function(){ healGuardian(); };

// Leaderboard modal
const modal = document.getElementById("leaderboardModal");
document.getElementById("showLeaderboardBtn").onclick = function(){ updateLeaderboard(); modal.style.display="block"; };
document.getElementById("closeModal").onclick = function(){ modal.style.display="none"; };
window.onclick = function(e){ if(e.target == modal) modal.style.display="none"; };

// Update HP text
function updateHPText(){ document.getElementById("hpText").innerText = `HP: ${hp} / ${guardians[gIndex].maxHP}`; }

// Leaderboard
function updateLeaderboard(){
  let tbody=document.getElementById("leaderboardBody"); tbody.innerHTML="";
  let sorted = Object.entries(board).sort((a,b)=>b[1]-a[1]);
  let userFound=false;
  for(let i=0;i<10;i++){
    if(i>=sorted.length) break;
    let [user, points]=sorted[i];
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td><td>${user}</td><td>${points}</td>`;
    tbody.appendChild(tr);
    if(user==uid) userFound=true;
  }
  if(!userFound){
    let pos=sorted.findIndex(([user,points])=>user==uid);
    if(pos==-1) pos=sorted.length;
    let points=board[uid]||0;
    let tr=document.createElement("tr");
    tr.innerHTML=`<td>${pos+1}</td><td>${uid} (You)</td><td>${points}</td>`;
    tbody.appendChild(tr);
  }
}

// Update UI
function updateGuardianUI(){
  const guardian = guardians[gIndex];
  document.getElementById("gname").innerText = `${guardian.name} â€“ ${guardian.maxHP} HP`;
  document.getElementById("glore").innerText = guardian.lore;
  document.getElementById("hp").value = hp;
  updateHPText();
  updateLeaderboard();
}
window.onload = updateGuardianUI;
</script>
</body>
</html>
