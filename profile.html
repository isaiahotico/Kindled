<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile</title>
<link rel="stylesheet" href="style.css">
<script src="app.js"></script>
</head>
<body class="charcoal">

<a class="home" href="index.html">ğŸ  Home</a>
<h2 class="rainbow">User Profile</h2>

<!-- Display All Users IDs -->
<div id="allUsers" style="color:white; margin-bottom:10px;"></div>

<div class="profile-card">
  <label>Name:</label>
  <input type="text" id="username" placeholder="Enter your name">
  <label>Bio:</label>
  <textarea id="userbio" placeholder="Enter your bio"></textarea>
  <label>Sex:</label>
  <select id="usersex">
    <option value="Unknown">Unknown</option>
    <option value="Male">Male</option>
    <option value="Female">Female</option>
    <option value="Other">Other</option>
  </select>
  <label>Relationship Status:</label>
  <select id="userrel">
    <option value="Single">Single</option>
    <option value="In a Relationship">In a Relationship</option>
    <option value="Married">Married</option>
    <option value="Complicated">Complicated</option>
  </select>

  <p>Unique ID / Affiliate Code: <span id="userid"></span></p>
  <p>Coins: <span id="usercoins">0</span></p>

  <button class="magic-btn blue" id="claimReward">ğŸ Claim Reward</button>
</div>

<h3>Affiliate Stats</h3>
<table class="profile-card" border="1">
  <thead>
    <tr><th>Invited User ID</th><th>Reward Earned</th></tr>
  </thead>
  <tbody id="affiliateTable"></tbody>
</table>

<script>
// Initialize UID
let uid = localStorage.getItem("uid") || Math.floor(100000 + Math.random() * 900000);
localStorage.setItem("uid", uid);
document.getElementById("userid").innerText = uid;

// Display all users
function showAllUsers(){
  let allKeys = Object.keys(localStorage).filter(k=>!k.startsWith('coins_') && k!=='profile' && k!=='uid' && k!=='allAffiliates');
  document.getElementById("allUsers").innerText = "All Users IDs: "+[uid, ...allKeys].join(", ");
}
showAllUsers();

// Load profile
let profile = JSON.parse(localStorage.getItem("profile") || "{}");
document.getElementById("username").value = profile.name || "";
document.getElementById("userbio").value = profile.bio || "";
document.getElementById("usersex").value = profile.sex || "Unknown";
document.getElementById("userrel").value = profile.rel || "Single";

// Auto-save on input change
['username','userbio','usersex','userrel'].forEach(id=>{
  document.getElementById(id).addEventListener("input",()=>{
    profile.name = document.getElementById("username").value;
    profile.bio = document.getElementById("userbio").value;
    profile.sex = document.getElementById("usersex").value;
    profile.rel = document.getElementById("userrel").value;
    localStorage.setItem("profile", JSON.stringify(profile));
  });
});

// Coins display
let coins = Number(localStorage.getItem("coins") || 0);
document.getElementById("usercoins").innerText = coins;

// Claim reward
document.getElementById("claimReward").onclick = function(){
  let reward = Math.floor(Math.random()*500)+500;
  coins += reward;
  localStorage.setItem("coins", coins);
  document.getElementById("usercoins").innerText = coins;
  giveAffiliateBonus(reward);
  alert(`ğŸ‰ You claimed ${reward} coins!`);
}

// Affiliates table
let allAffiliates = JSON.parse(localStorage.getItem("allAffiliates") || "{}");
if(!allAffiliates[uid]) allAffiliates[uid]=[];
localStorage.setItem("allAffiliates", JSON.stringify(allAffiliates));

function updateAffiliateTable(){
  let tbody = document.getElementById("affiliateTable");
  tbody.innerHTML="";
  let userAffiliates = allAffiliates[uid] || [];
  userAffiliates.forEach(a=>{
    let tr = document.createElement("tr");
    tr.innerHTML = `<td>${a.uid}</td><td>${a.reward || 0}</td>`;
    tbody.appendChild(tr);
  });
}
updateAffiliateTable();
</script>
</body>
</html>
